# yaml-language-server: $schema=https://moonrepo.dev/schemas/project.json

stack: frontend
layer: application

fileGroups:
  assets:
    - assets/**/*
  sources:
    - src/**/*
    - Cargo.toml
    - Dioxus.toml
    - .env
  tests:
    - tests/**/*

tasks:
  build/dev:
    command: dx build
    inputs:
      - "@globs(sources)"
      - "@globs(assets)"
  build/release:
    extends: build/dev
    args: ["--release"]
  serve/dev:
    command: dx serve --addr 0.0.0.0
    preset: watcher
  serve/release:
    command: dx serve --addr 0.0.0.0 --release
    preset: watcher
  test:
    command: cargo test
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
  check:
    command: cargo check
    inputs:
      - "@globs(sources)"
  dx/fmt:
    command: dx fmt
    inputs:
      - "@globs(sources)"
  fmt:
    command: cargo fmt
    inputs:
      - "@globs(sources)"
    deps:
      - dx/fmt
  dx/fmt/check:
    extends: dx/fmt
    args: ["--check"]
  fmt/check:
    extends: fmt
    args: ["--check"]
    deps:
      - dx/fmt/check
    options:
      mergeDeps: replace
  clippy/check:
    command: cargo clippy
    args: ["--", "--deny", "warnings"]
    inputs:
      - "@globs(sources)"
